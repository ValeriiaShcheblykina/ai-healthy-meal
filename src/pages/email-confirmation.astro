---
import Layout from '@/layouts/Layout.astro';
import { Button } from '@/components/ui/button';

// Force SSR for this page
export const prerender = false;

// Check URL parameters for success/error states
const isSuccess = Astro.url.searchParams.get('success') === 'true';
const error = Astro.url.searchParams.get('error');
---

<Layout title="Email Confirmation - AI Healthy Meal">
  <div class="flex min-h-screen items-center justify-center px-4 py-12">
    <div class="w-full max-w-sm">
      <div class="mb-8 text-center">
        <h1 class="mb-2 text-3xl font-bold">
          {
            isSuccess
              ? 'Email Verified!'
              : error
                ? 'Verification Failed'
                : 'Check Your Email'
          }
        </h1>
      </div>

      <div class="bg-card rounded-lg border p-8 shadow-sm">
        {
          isSuccess ? (
            <div class="space-y-6">
              <div
                class="rounded-md border border-green-200 bg-green-50 px-4 py-3 text-green-900 dark:border-green-800 dark:bg-green-950 dark:text-green-100"
                role="status"
              >
                <p class="text-sm">
                  Your email has been successfully verified! You can now sign in
                  to your account.
                </p>
              </div>

              <Button asChild className="w-full">
                <a href="/sign-in">Continue to Sign In</a>
              </Button>
            </div>
          ) : error ? (
            <div class="space-y-6">
              <div
                class="bg-destructive/10 text-destructive border-destructive/20 rounded-md border px-4 py-3"
                role="alert"
              >
                <h3 class="mb-1 font-semibold">Verification link invalid</h3>
                <p class="text-sm">
                  {error === 'invalid_token'
                    ? 'This verification link is invalid or has expired. Please request a new one.'
                    : 'An error occurred during verification. Please try again.'}
                </p>
              </div>

              <div class="space-y-3">
                <Button asChild variant="outline" className="w-full">
                  <a href="/sign-up">Request New Verification Email</a>
                </Button>
                <Button asChild variant="ghost" className="w-full">
                  <a href="/sign-in">Back to Sign In</a>
                </Button>
              </div>
            </div>
          ) : (
            <div class="space-y-6">
              <div
                class="rounded-md border border-blue-200 bg-blue-50 px-4 py-3 text-blue-900 dark:border-blue-800 dark:bg-blue-950 dark:text-blue-100"
                role="status"
              >
                <h3 class="mb-1 font-semibold">Verify your email address</h3>
                <p class="mb-3 text-sm">
                  We've sent a verification email to your address. Please click
                  the link in the email to verify your account.
                </p>
                <p class="text-sm">
                  Can't find the email? Check your spam folder or request a new
                  one.
                </p>
              </div>

              <div class="space-y-3">
                <Button asChild variant="outline" className="w-full">
                  <a href="/api/auth/resend-verification">
                    Resend Verification Email
                  </a>
                </Button>
                <Button asChild variant="ghost" className="w-full">
                  <a href="/sign-in">Back to Sign In</a>
                </Button>
              </div>
            </div>
          )
        }
      </div>

      {
        !isSuccess && !error && (
          <p class="text-muted-foreground mt-6 text-center text-sm">
            Didn't receive an email? Make sure to check your spam folder.
          </p>
        )
      }
    </div>
  </div>
</Layout>
